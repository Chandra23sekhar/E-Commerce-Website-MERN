<html>
  <head>
  <style>
      .hidden {
        display: none;
      }
      label {
        margin-bottom: 10px;
        display: block;
      }
    </style>
  </head>
  <body>
    <h1>Infoworld: Intro to Auth0</h1>
    <button id="btn-login" disabled="true" onclick="login()">Log in</button>
    <button id="btn-logout" disabled="true" onclick="logout()">Log out</button>

    <h2>Fetch Open API</h2>
    <h3 id="openMessage"></h3>
    <button onclick="fetchOpenApi()">Open API</button>

    <h2>Fetch Members Only API</h2>
    <h3 id="moMessage"></h3>
    <button onclick="fetchMembersOnlyApi()">Members Only API</button>

    <h2>Fetch Protected API</h2>
    <h3 id="protectedMessage"></h3>
    <button onclick="fetchProtectedApi()">Protected API</button>
    <hr>
    <div class="hidden" id="gated-content">
      <p>
        This content is hidden until user is logged in.
      </p>
      <label>
        Access token:
        <pre id="ipt-access-token"></pre>
      </label>
      <label>
        User profile:
        <pre id="ipt-user-profile"></pre>
      </label>
    </div>
  </body>
</html>

<script>
  async function fetchOpenApi(){
    let result = await fetch("/api/open");
    let json = await result.json();
    document.getElementById("openMessage").innerHTML = JSON.stringify(json.message);
  }
  async function fetchMembersOnlyApi(){
    const token = await auth0.getTokenSilently();
    let result = await fetch("/api/members-only");
    let json = await result.json();
    document.getElementById("moMessage").innerHTML = JSON.stringify(json.message);
  }
  async function fetchProtectedApi(){
    const token = await auth0.getTokenSilently();
    let result = await fetch("/api/protected");
    let json = await result.json();
    document.getElementById("protectedMessage").innerHTML = JSON.stringify(json.message);
  }
</script>